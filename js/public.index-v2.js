function AJAJ_ON_READYSTATE_CHANGE(e,t){if(AJAJ_CALLBACKS[e])try{AJAJ_CALLBACKS[e](t)}catch(n){}}function Ajaj(e,t){this.id=Number(new Date).toString()+parseInt(10*Math.random())+parseInt(10*Math.random())+parseInt(10*Math.random()),this.url=e||"",this.params=t.parameters||{},this.onComplete=t.onComplete||this.defaultOnCompleteFunc,this.onLoading=t.onLoading||this.defaultOnLoadingFunc,this.onError=t.onError||this.defaultOnErrorFunc,this._start()}function gotohq(){open("http://hq.p5w.net/")}jQuery.extend({evalJSON:function(strJson){return eval("("+strJson+")")}}),jQuery.extend({toJSONString:function(e){var t=typeof e;"object"==t&&(Array==e.constructor?t="array":RegExp==e.constructor?t="regexp":t="object");switch(t){case"undefined":case"unknown":return;case"function":case"boolean":case"regexp":return e.toString();case"number":return isFinite(e)?e.toString():"null";case"string":return'"'+e.replace(/(\\|\")/g,"\\$1").replace(/\n|\r|\t/g,function(){var e=arguments[0];return e=="\n"?"\\n":e=="\r"?"\\r":e=="	"?"\\t":""})+'"';case"object":if(e===null)return"null";var n=[];for(var r in e){var i=jQuery.toJSONString(e[r]);i!==undefined&&n.push(jQuery.toJSONString(r)+":"+i)}return"{"+n.join(",")+"}";case"array":var n=[];for(var s=0;s<e.length;s++){var i=jQuery.toJSONString(e[s]);i!==undefined&&n.push(i)}return"["+n.join(",")+"]"}}}),AJAJ_CALLBACKS={},Ajaj.prototype={_start:function(){this.sender=document.createElement("SCRIPT"),this.sender.id=this.sender.name="SCRIPT_REQUESTER_"+this.id,this.sender.type="text/javascript",document.getElementsByTagName("head")[0].appendChild(this.sender),this.loadData()},parseParams:function(){var e="";if(this.params)for(var t in this.params)t!="toJSONString"&&(e+=t+"="+this.params[t]+"&");return e+="crossdomain="+this.id+"&from="+window.location.host,e},loadData:function(){if(this.sender){this.onLoading();try{AJAJ_CALLBACKS[this.id]=null,AJAJ_CALLBACKS[this.id]=function(e){this.onComplete(e),window.setTimeout(this.destroy.bind(this),100)}.bind(this),this.sender.onreadystatechange=this.sender.onload=function(){};var t=this.parseParams(this.params),n="";n=this.url.indexOf("?")!=-1?this.url+"&"+t:this.url+"?"+t,this.sender.src=n}catch(r){this.onError(e)}}},defaultOnCompleteFunc:function(){},defaultOnLoadingFunc:function(){},defaultOnErrorFunc:function(){},destroy:function(){this.onComplete=function(){},delete AJAJ_CALLBACKS[this.id],this.sender&&document.getElementsByTagName("head")[0].removeChild(this.sender),this.sender=null}},Function.prototype.bind=function(e){var t=this;return function(){return t.apply(e,arguments)}},Function.prototype.bind2=function(e){var t=this,n=Array.prototype.slice.call(arguments,1);return function(){return t.apply(e,n,arguments)}},function(e){e.hqLoader=function(t,n){e.hqLoader.defaultOptions={stocks:[],class_render:"render",updateInterval:15e3,jsonSrv:"http://www.p5w.net/jsdata/",hqUrl:"http://data.p5w.net/stock/market.php?code=@code@",timeInfoStr:"570,571,572,573,574,575,576,577,578,579,580,581,582,583,584,585,586,587,588,589,590,591,592,593,594,595,596,597,598,599,600,601,602,603,604,605,606,607,608,609,610,611,612,613,614,615,616,617,618,619,620,621,622,623,624,625,626,627,628,629,630,631,632,633,634,635,636,637,638,639,640,641,642,643,644,645,646,647,648,649,650,651,652,653,654,655,656,657,658,659,660,661,662,663,664,665,666,667,668,669,670,671,672,673,674,675,676,677,678,679,680,681,682,683,684,685,686,687,688,689,781,782,783,784,785,786,787,788,789,790,791,792,793,794,795,796,797,798,799,800,801,802,803,804,805,806,807,808,809,810,811,812,813,814,815,816,817,818,819,820,821,822,823,824,825,826,827,828,829,830,831,832,833,834,835,836,837,838,839,840,841,842,843,844,845,846,847,848,849,850,851,852,853,854,855,856,857,858,859,860,861,862,863,864,865,866,867,868,869,870,871,872,873,874,875,876,877,878,879,880,881,882,883,884,885,886,887,888,889,890,891,892,893,894,895,896,897,898,899,900",chartWidth:270,chartHeight:135};var r=this;r.$el=e(t),r.el=t,r.$el.data("hqLoader",r),r.init=function(){r.options=e.extend({},e.hqLoader.defaultOptions,n),r.updateHandle=new Array,r.chartSeries=new Array,r.charts=new Array;if(r.options.stocks.length<=0)return;var t=new Array;t.push('<div class="tabs">'),t.push('<div class="tabsHead">'),t.push('<div class="innerTabsHead">'),t.push("<ul>");for(var i=0;i<r.options.stocks.length;i++){var s=r.options.stocks[i],o=typeof s.tab=="undefined"?s.name:s.tab;t.push("<li>"+o+"</li>")}t.push("</ul>"),t.push("</div>"),t.push("</div>"),t.push('<div class="indexs_container">');for(var i=0;i<r.options.stocks.length;i++){var s=r.options.stocks[i];t.push('<div class="tabBox" style="display:none;">'),t.push("<dl>"),t.push('<dt><span class="n1"><a href="'+r.options.hqUrl.replace("@code@",s.code)+'" target="_blank">'+s.name+'</a></span><span class="n2">--</span><span class="n3">--</span><span class="n4">--</span></dt>'),t.push("<dd>"),t.push('<div class="chart" style="width:'+r.options.chartWidth+"px; height:"+r.options.chartHeight+'px;">'),t.push('<img src="http://www.p5w.net/images/loading.gif" alt="" />'),t.push("</div>"),t.push("</dd>"),t.push("</dl>"),t.push("</div>")}t.push("</div>"),t.push("</div>"),r.$el.html(t.join("")),r.$el.find(".tabsHead li").eq(0).addClass("hover"),r.$el.find(".tabBox").eq(0).show(),r.tabs=r.$el.find(".tabs"),r.charts=r.$el.find(".chart"),r.tabs.Tabs({fadeSpeed:0,TabEvent:"click",onHover:function(t,n){e(e(n).get(t)).find("dd").hasClass(r.options.class_render)?r.updateChart(t):r.loadData(t)}}),r.tabs.find("li:first-child").trigger("click")},r.loadData=function(e){var t=r.options.stocks[e].code;if(!t)return;var n=t.substr(0,2),i=t.substr(2,6),s={method:"get",onComplete:function(n){var i=r.parseData(n);if(!i||i.indexHq.length==0||i.points.length==0)return;r.drawMinLine(i.indexHq,i.points,e,t,null),r.charts.eq(e).parent().addClass(r.options.class_render)}.bind(this)};infoURL="http://hq.p5w.net/info/data.py/quick?cmd="+t+"|00000000|000000|0|"+Math.random().toString();var o=new Ajaj(infoURL,s)},r.updateChart=function(t){var n=function(i){var s=r.chartSeries[t];if(!s)return;var o=new Date,u=o.getHours(),a=o.getMinutes(),f=u*60+a,l=o.getDay();if(f>=565&&f<=691||f>=780&&f<=905){var c={method:"get",onComplete:function(n){var o=r.parseData(n);if(!o||o.indexHq.length==0||o.points.length==0)return;var u=r.getTickPositions(o.points);s.yAxis.setOptions(e.extend({},s.yAxis.options,{tickPositions:u,opposite:!0})),s.setData(o.indexHq,!0),r.setRealtimeData(o.points,t,i)}.bind(this)},h=r.options.stocks[t].code;infoURL="http://hq.p5w.net/info/data.py/quick?cmd="+h+"|00000000|000000|0|"+Math.random().toString();var p=new Ajaj(infoURL,c)}r.updateHandle[t]&&clearTimeout(r.updateHandle[t]),r.updateHandle[t]=setTimeout(function(){n(!0)},r.options.updateInterval)};n(!1)},r.parseData=function(t){try{var n=e.parseJSON(t)}catch(i){return{indexHq:[],points:[]}}if(!n.ret||n.ret!="OK")return{indexHq:[],points:[]};var s=n.info.instant,o=parseFloat(s[0]),u=parseFloat(s[1]),a=parseFloat(s[5]),f=parseFloat(s[6]),l=parseFloat(s[2]),c=0,h=0;c=l-o,o!=0&&(h=c/o);var p=[o,u,a,f,l,c,h],d=r.options.timeInfoStr.split(","),v=n.info.history,m=[];for(var g=0;g<d.length;g++){var y=d[g]*6e4,b=null;v[g]&&(b=v[g][0]),m.push([y,b])}return{indexHq:m,points:p}},r.drawMinLine=function(t,n,i,s,o){Highcharts.setOptions({global:{useUTC:!0},lang:{months:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],shortMonths:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],weekdays:["星期日","星期一","星期二","星期三","星期四","星期五","星期六"]}});var u=r.getPlotLines(n),a=r.getTickPositions(n);r.setRealtimeData(n,i,!1),new Highcharts.StockChart({chart:{renderTo:r.charts.eq(i)[0],borderWidth:0,borderRadius:0,borderColor:"#dddddd",width:r.options.chartWidth,height:r.options.chartHeight,events:{load:function(){var e=this.series[0];r.chartSeries[i]=e,r.updateChart(i)}}},loading:{style:{backgroundColor:"silver"},labelStyle:{color:"white"}},legend:{enabled:!1},exporting:{enabled:!1},credits:{enabled:!0,text:"p5w.net",href:"javascript:gotohq()",position:{align:"right",x:-50,verticalAlign:"bottom",y:-35},style:{cursor:"pointer",color:"#999999",fontSize:"10px",fontFamily:"Arial"}},rangeSelector:{enabled:!1},scrollbar:{enabled:!1},tooltip:{backgroundColor:{linearGradient:[0,0,0,200],stops:[[0,"rgba(96, 96, 96, .8)"],[1,"rgba(16, 16, 16, .8)"]]},borderWidth:0,style:{color:"#FFF"},formatter:function(){var t="<b>"+Highcharts.dateFormat("%H:%M",this.x)+"</b>";return e.each(this.points,function(e,n){t+="<br/>"+(new Number(n.y)).toFixed(2)}),t}},xAxis:{type:"datetime",dateTimeLabelFormats:{second:"%H:%M",minute:"%H:%M",hour:"%H:%M",day:"%H:%M",week:"%H:%M",month:"%H:%M",year:"%H:%M"},gridLineDashStyle:"dash",gridLineWidth:.5,tickPositions:[342e5,378e5,414e5,504e5,54e6],labels:{style:{position:"absolute",color:"#0086d2",fontFamily:"Consolas",fontSize:"11px"},formatter:function(){var e=this.value/6e4,t=e%60,n=(e-t)/60+":";return n=t<10?n+"0"+t:n+t,e==690&&(n+="/13:00"),e==630||e==840?"":n}}},yAxis:{title:{text:""},showLastLabel:!0,opposite:!0,labels:{formatter:function(){return(new Number(this.value)).toFixed(0)},align:"left",x:3,y:3,style:{color:"#272727",fontFamily:"Consolas",fontSize:"11px"}},gridLineWidth:.5,plotLines:null,tickPositions:a},navigator:{enabled:!1},series:[{color:"#f00000",data:t,threshold:null,type:"area",tooltip:{valueDecimals:2},fillColor:{linearGradient:{x1:0,y1:0,x2:0,y2:1},stops:[[0,"#fffab0"],[1,"rgba(255 ,250 ,176,0)"]]}}]})},r.setRealtimeData=function(t,n,i){try{var s=parseFloat(t[0]),o=parseFloat(t[2]),u=parseFloat(t[3]),a=parseFloat(t[4]),f=parseFloat(t[5]),l=parseFloat(t[6])}catch(c){}var h=r.charts.eq(n).parent().parent().find("dt");h.removeClass("red").removeClass("green"),f>0?h.addClass("red"):f<0&&h.addClass("green");var p=e(".n1",h),d=e(".n2",h),v=e(".n3",h),m=e(".n4",h);if(i){var g="#e1fce1",y="#ffffff";f>0?g="#f9e0e1":f<0&&(g="#e1fce1"),d.css({background:g}).html(a.toFixed(2)),v.css({background:g}).html(f.toFixed(2)),m.css({background:g}).html((l*100).toFixed(2)+"%"),setTimeout(function(){d.css({background:y}),v.css({background:y}),m.css({background:y})},1e3)}else d.html(a.toFixed(2)),v.html(f.toFixed(2)),m.html((l*100).toFixed(2)+"%")},r.getPlotLines=function(e){var t=null,n=0;try{e&&e.length>3&&(n=parseFloat(e[0]))}catch(r){}return t=[{value:n,color:"#999999",dashStyle:"shortdash",width:2,label:{text:""}}],t},r.getTickPositions=function(e){var t=0,n=0,r=0,i=0,s=0,o=null;try{t=parseFloat(e[0]),r=parseFloat(e[2]),n=parseFloat(e[3]),i=parseFloat(e[4]),s=parseFloat(e[5])}catch(u){}var a=0,f=0,l=0;return r<=0&&(r=t),n<=0&&(n=t),Math.abs(t-n)>Math.abs(t-r)?(a=n,l=Math.abs(n-t),f=t+l):(l=Math.abs(r-t),a=t-l,f=r),o=[parseFloat(a).toFixed(2),parseFloat(t-l/2).toFixed(2),parseFloat(t).toFixed(2),parseFloat(t+l/2).toFixed(2),parseFloat(f).toFixed(2)],o},r.init()},e.fn.hqLoader=function(t){return this.each(function(){new e.hqLoader(this,t)})}}(jQuery);