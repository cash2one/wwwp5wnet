/**
 * 通行证
 * @version        $.Id:Passport.js   13-3-1 上午10:07
 * @author         lifuping
 * @copyright      Panorama Network Co., Ltd, All Rights Reserved
 * @link           http://www.p5w.net
 */function Passport(){var e=this;this.domain="p5w.net",this.loginFormId="login",this.loginFrameName="loginFrame",this.loginElm="#loginArea,[name='loginArea'],[action-type='loginArea']",this.loginBtn="#loginBtn,[name='loginBtn'],[action-type='loginBtn']",this.form=null,this.errDiv=null,this.user=null,this.formCallBack=null,this.css=!1,this.zindex=1e3,this.strings={0:"登录成功。",100:"您的帐号或密码填写有误，请重新输入",101:"您输入的验证码有误，请重新输入！"},this.config={login:{template:"",width:"420px",title:"用户登录"},link:{userhome:"http://passport.p5w.net/",reg:"http://passport.p5w.net/register.php",loginaction:"http://passport.p5w.net/sso/login.php",login:"http://passport.p5w.net/login.php",logout:"http://passport.p5w.net/logout.php",forgot:"http://bbs.p5w.net/member.php?mod=logging&action=login&viewlostpw=1",verifyimg:"http://passport.p5w.net/plus/verifycode.php"}},this.reg_type=1,this.is_ie=/msie/i.test(navigator.userAgent),this.is_ie6=e.is_ie&&/msie 6\.0/i.test(navigator.userAgent),this.is_opera=/opera/i.test(navigator.userAgent);var t=new Array;t=['<div class="login_box" id="_passport_login" title="用户登录">','<div class="login_box_msg" action-type="tips"></div>','<noscript><div class="login_box_msg noScript">您的浏览器不支持或已经禁止网页脚本，您无法正常登录。<a href="/help/error_noscript.html" title="了解网页脚本限制的更多信息" target="_blank"><img src="/images/ico_help104474.gif" style="margin:0 2px;" align="absmiddle" />如何解除脚本限制</a></div></noscript>','<div class="login_operate">','<form id="_passport_login_form" method="post" name="loginform" autocomplete="on">','<div class="username"><label class="txt_default" default_txt="登录帐号">登录帐号</label><input action-type="nfocusUsername" class="txt" tabindex="1" name="username" value="" type="text"></div>','<div class="password"><label class="txt_default" default_txt="登录密码">登录密码</label><input action-type="nfocusPassword" class="txt password" tabindex="2" name="password" type="password"></div>','<div id="verifyinput" class="vfcode">','<div class="vfcodeinput"><label class="txt_default" default_txt="验证码">验证码</label><input action-type="nfocusVerifycode" class="txt" tabindex="4" name="verifycode" maxlength="4" value="" type="text" autocomplete="off"><div class="verifytip">按右图填写，不区分大小写</div></div>','<div class="gray vfcode_img"><img action-type="verifyimg" src="'+this.config.link.verifyimg+'" alt="验证码"><div class="vfcode_change"><a action-type="verifyshow" href="javascript:;">看不清楚？换一个</a></div></div>','<div style="clear:both;"></div></div>','<div class="login_submit"><a class="login_btn_wrapper" href="javascript:;" action-type="login" name="btn"><input class="login_btn" tabindex="5" value="登录" type="button"></a></div>','<div class="about_password"><input name="remember" class="remerber_password" tabindex="5" type="checkbox" style="display:none"><label for="remerber_password"  style="display:none">记住登录状态</label><a class="regaccount" href="'+this.config.link.reg+'" >没有帐号？注册</a>&nbsp;&nbsp<a class="forgetPassword" href="'+this.config.link.forgot+'" target="_blank">忘记密码？</a></div>',"</form>","</div>","</div>"],this.config.login.template=t.join(""),this.setLoginElm=function(t){e.loginElm=t},this.cookie={get:function(e){var t=document.cookie.match(new RegExp("(^| )"+e+"=([^;]*)(;|$)"));return unescape(t?t[2]:"")},clear:function(e,t,n){document.cookie=e+"=; expires=Mon, 26 Jul 1997 05:00:00 GMT; path="+(n?n:"/")+"; "+(t?"domain="+t+";":"")},set:function(e,t,n,r,i){var s=new Date;s.setTime(s.getTime()+(i?6e4*i:2592e6)),document.cookie=e+"="+t+"; expires="+s.toGMTString()+"; path="+(r?r:"/")+"; "+(n?"domain="+n+";":"")}},this.setCookie=function(e,t,n,r,i){var s=e+"="+escape(t);if(n){n=="never"&&(n=5256e4);var o=new Date;o.setTime(o.getTime()+n*60*1e3),s+="; expires="+o.toGMTString()}r&&(s+="; path="+r),i&&(s+="; domain="+i),document.cookie=s},this.getCookie=function(e){var t=document.cookie.indexOf(e+"="),n=t+e.length+1;if(!t&&e!=document.cookie.substring(0,e.length))return null;if(t==-1)return null;var r=document.cookie.indexOf(";",n);return r==-1&&(r=document.cookie.length),decodeURI(document.cookie.substring(n,r))},this.delCookie=function(t,n,r){e.getCookie(t)&&(document.cookie=t+"="+(n?";path="+n:"")+(r?";domain="+r:";domain=.p5w.net")+";expires=Thu, 01-Jan-1970 00:00:01 GMT")},this.$=function(e){var t=null;return typeof e=="object"?t=e:t=document.getElementById(e),t?t:null},this.$F=function(e){return document.getElementById(e).value},this.createElement=function(e,t,n){var r=null;return document.createElementNS?r=document.createElementNS("http://www.w3.org/1999/xhtml",e):r=document.createElement(e),typeof t!="undefined"&&t.appendChild(r),typeof n!="undefined"&&(n.indexOf(":")>0?r.style.cssText=n:r.className=n),r},this.createForm=function(t){var n=e.$(t);n&&n.parentNode.removeChild(n);var r="height:0px;width:0px;display:none;";return n=e.createElement("form",document.getElementsByTagName("body")[0],r),n.id=n.name=t,n.addData=function(e,t,n){n==null&&(n="text");var r=this.getElementsByTagName("input")[e];r=document.createElement("input"),this.appendChild(r),r.id=e,r.name=e,r.value=t,r.type=n},n},this.createFrame=function(t,n){var r=e.$(t);return r&&r.parentNode.removeChild(r),n?r=e.createElement("iframe",n):r=e.createElement("iframe"),r.style.cssText="height:0px;width:0px;display:none;",r.setAttribute("frameborder","0"),r.id=r.name=t,r.src="javascript:;",n?n.appendChild(r):document.getElementsByTagName("body")[0].appendChild(r),window.frames[t].name=t,r},this.callBack=function(){if(typeof e.formCallBack=="function")return e.formCallBack(),!1;e.form!=null?typeof e.form.referer!="undefined"&&e.form.referer.value!=""?window.location.href=e.form.referer.value:window.location.reload():window.location.reload()},this.lib={getQueryString:function(e){var t={},n=/[?&]([^=]+)(?:=([^&]*))?/g,r;while(r=n.exec(location.search))t[r[1]]=r[2];return typeof t[e]=="undefined"?"":t[e]},action:function(){$('[action-type="verifyimg"],[action-type="verifyshow"]').click(function(){$('[action-type="verifyimg"]').attr("src",e.config.link.verifyimg+"?key="+Math.round(Math.random(0)*1e6)+"")}),$('[action-type="login"]',e.draw.Dialog).click(function(){e.form=$(this).parents("form")[0],e.tipsDiv=$('[action-type="tips"]'),e.login()}),$('[action-type="nfocusUsername"]',e.draw.Dialog).Placeholder(),$('[action-type="nfocusPassword"]',e.draw.Dialog).Placeholder(),$('[action-type="nfocusVerifycode"]',e.draw.Dialog).Placeholder(),$(document).keyup(function(t){var n=window.event?t.keyCode:t.which;e.form=$("#_passport_login_form")[0],typeof e.form!="undefined"&&n==13&&e.form.password.value!=""&&(e.tipsDiv=$('[action-type="tips"]'),e.login()),e.draw.Dialog&&n==27&&e.draw.close()})}},function(){$(function(){navigator.platform.indexOf("Mac")>=0&&$("body").addClass("MacOS");var t=window.location.host;t.indexOf("p5w.net")>0&&(document.domain=e.domain)})}(),this.draw={type:"login",Dialog:null,css:null,init:function(t){t||(t="login"),e.draw.Dialog!=null&&e.draw.Dialog.remove(),this.css();var n=e.config.login.template.replace(/{forgot_url}/,e.config.link.forgot).replace(/{captcha_url}/,e.config.link.verifyimg);return e.draw.Dialog=$(n),e.draw.Dialog.dialog({autoOpen:!1,dialogClass:"p5w-dialog",height:350,width:350,modal:!0,resizable:!1,closeText:"关闭",buttons:{},close:function(){e.draw.Dialog.remove()}}),e.lib.action(),e.draw.Dialog.dialog("open"),$('input[name="verifycode"],input[name="captcha"]',e.draw.Dialog).keyup(function(t){var n=window.event?t.keyCode:t.which;n==13&&(e.form=$("#_passport_login_form")[0],e.tipsDiv=$('[action-type="tips"]'),e.login(),t.stopPropagation())}),!1},css:function(){if(!e.css){var t=".login_box { position: relative; z-index: 11;padding: 20px; border: 0px solid #ACC3E4; background: #FFF; -moz-box-shadow: 2px 2px 3px rgba(0,0,0,0.15); -webkit-box-shadow: 2px 2px 3px rgba(0,0,0,0.15); border-radius: 5px; -webkit-border-radius: 5px; }                .login_box h1 { color: #274571; font-size: 16px; }                .login_box .login_https { text-align: right; margin-top: -16px; }                .login_box .login_operate { padding: 5px 0 20px 0px;width:300px;margin:0 auto 0 auto; }                .login_operate .username, .login_operate .password, .login_operate .about_password, .login_operate .login_submit { position: relative; width: 305px; padding: 5px 0; z-index: 29; }                .login_operate .login_submit .login_cancel { margin-left: 12px; }                .login_operate .username { height: 38px; position: relative; z-index: 109; }                .login_operate .about_password { padding: 4px 0; z-index: 19; }                .login_operate .vfcodeinput { height: 34px; padding-bottom: 0px; }                .login_box .txt { position: relative; width: 295px; height: 34px; line-height: 34px; padding: 0 4px; color: #494949; border: 1px solid #fff;border-bottom:solid 1px #ced6da; font-size: 20px; background: transparent; outline: none; border-radius: 3px; -webkit-border-radius: 3px; -webkit-transition: -webkit-box-shadow .1s linear; -moz-transition: box-shadow .1s linear; }                .login_box .txt_default { position: absolute; top: 6px; left: 1px; width: 289px; height: 34px; padding: 0 7px; line-height: 34px; font-size: 14px; color: #8B9096; background: url("+e.config.link.userhome+"images/passport1.gif) no-repeat scroll -1px -97px white; border-radius: 3px; -webkit-border-radius: 3px; }                .login_box .txt:focus { border: 1px solid #fff;border-bottom:solid 1px #ced6da; }                .login_box .about_password { padding: 4px 0; }                .login_box .remerber_password { margin-right: 4px; margin-left: -4px9; vertical-align: middle; }                .login_box .about_password a { position: absolute; right: 0; padding-top: 4px9; }                .login_box .about_password a.regaccount { position: absolute; right: 80px; padding-top: 4px9;color:#0000ff }                .login_box .vfcode { margin-top: 10px;}                .login_box .vfcode_img { float: right; padding: 5px 0 0; padding-top: 6px9; text-align: right; }                .login_box .vfcodeinput { position: relative; float: left; padding: 5px 0; }                .login_box .vfcodeinput .verifytip,.login_box .vfcode_change {display:none; }                .login_box .vfcodeinput input, .login_box .vfcodeinput label { width: 148px; height: 34px; line-height: 34px; letter-spacing: 2px; font-size: 20px; }                .login_box .vfcodeinput label { font-size: 14px; line-height: 33px; width: 142px; }                .login_box .vfcode_img img { width: 130px; height: 34px; border: 1px solid #CFD7E2; vertical-align: top; cursor: pointer; }                .login_operate .login_submit { clear: both; text-align: center; width: 295px;border-top:solid 0px #dadada }                .login_box .login_btn_wrapper {display:inline-block; width:84px; height:33px; margin-top:9px; border:0;background:url("+e.config.link.userhome+"images/denglu.png)  no-repeat;}                .login_box .login_btn_wrapper:hover {text-decoration:none;background:url("+e.config.link.userhome+"images/denglu-hover.png)  no-repeat;}                .login_box .login_btn_wrapper:active { background-position: 0 -64px; }                .login_box .login_btn { width: 84px; height: 33px; border: none; line-height: 33px; font-size: 16px; font-weight: bold; color: #fff; background: transparent; cursor: pointer; }                .login_box .login_btn_wrapper_disabled .login_btn { opacity: 0.7; }                .login_box .login_tips { padding-top: 15px; line-height: 18px; }                .login_box .login_tips p { margin-top: 3px; }                .login_box .login_box_msg { margin: 0px auto 0px auto; padding: 2px; color: red; width: 295px; height: 22px; border: solid 1px #fff; background: #fff; line-height: 22px; }                .login_box .info_tips { border: solid 1px #FADC80; background: #FFF9E3; }                .login_box .about_password label,.login_box .about_password a {color:#999;}                .login_box .loading_tips { height: 22px; width: 295px; text-align: center; }                .login_box .loading_tips img { width: 22px; height: 22px; vertical-align: middle; }                .login_box .loading_tips span { padding-left: 5px; line-height: 22px; }                .login_box .noCookie, .login_box .noScript { padding: 6px; border: 1px solid #FADC80; line-height: 1.5; color: black; background: #FFF9E3; }",n=document.createElement("STYLE");n.setAttribute("type","text/css"),n.styleSheet?n.styleSheet.cssText=t:n.appendChild(document.createTextNode(t)),document.getElementsByTagName("head")[0].appendChild(n),e.css=!0}},close:function(){e.draw.Dialog&&e.draw.Dialog.dialog("close")}},this.resfhverifyimg=function(){$('[action-type="verifyimg"]').attr("src",e.config.link.verifyimg+"?key="+Math.round(Math.random(0)*1e6)+"")},this.checkLogin=function(){$.getJSON(e.config.link.userhome+"getUserName.php?callback=?",function(t){e.user=t.user;if(e.user.uid>0){var n=$('input[name="referer"]').val()||document.location.href;n||(n=e.config.link.userhome),$(e.loginElm).html('欢迎您，<span class="black" id="p5w_username">'+decodeURIComponent(e.user.username)+'</span> | <a href="'+e.config.link.logout+"?referer="+encodeURIComponent(n)+'">退出</a> | <a href="'+e.config.link.userhome+'" target="_blank">用户中心</a>')}else $(e.loginElm).html('<a href="'+e.config.link.login+'" action-type="loginBtn" target="_blank">登录</a> | <a href="'+e.config.link.reg+'" target="_blank">注册</a>'),$(e.loginBtn).click(function(){return passport.draw.init("login"),!1})})},this.getUser=function(t){if(e.user!=null){if(typeof t=="function"){var n=[];n.push(e.user);for(var r=1;r<arguments.length;r++)n.push(arguments[r]);t.apply(e,n)}}else $.getJSON(e.config.link.userhome+"getUserName.php?callback=?",function(n){e.user=n.user;if(typeof t=="function"){var r=[];r.push(e.user);for(var i=1;i<arguments.length;i++)r.push(arguments[i]);t.apply(e,r)}})},this.login=function(){var t=e.form.username,n=e.form.password,r=e.form.verifycode;if(t.value.trim()==""||t.value.trim()=="登录帐号")return e.notice("请填写登录帐号"),t.focus(),!1;if(n.value=="")return e.notice("请填写密码"),n.focus(),!1;if(r.value.trim()==""||r.value.trim()=="验证码")return e.notice("请填写验证码"),r.focus(),!1;var i=e.createFrame(e.loginFrameName),s=e.createForm(e.loginFormId,e.form);for(var o in e.form)e.form[o]!=null&&(e.form[o].type=="text"||e.form[o].type=="hidden"||e.form[o].type=="password"||e.form[o].type=="select-one"||e.form[o].type=="checkbox"&&e.form[o].checked==1)&&(e.form[o].name=="username"?s.addData(e.form[o].name,encodeURIComponent(e.form[o].value)):s.addData(e.form[o].name,e.form[o].value));s.method="post",s.action=e.config.link.loginaction,s.target=e.loginFrameName;try{s.submit(),typeof e.form.btn!="undefined"&&(e.form.btn.disabled=!0),typeof e.tipsDiv!="undefined"?e.notice("正在登录...","loading"):""}catch(u){i&&i.parentNode.removeChild(i)}s.parentNode.removeChild(s)},this.defaultLoginErrorCallBack=function(t){return e.distroy(),e.notice(t.msg),typeof e.form.btn!="undefined"&&(e.form.btn.disabled=""),t.status==-101?(e.form.verifycode.value="",e.form.verifycode.focus()):(e.form.password.value="",e.form.password.focus()),e.resfhverifyimg(),!1},this.defaultLoginSuccessCallBack=function(t){e.draw!=null?e.draw.close():"",e.user=t.user,$(e.loginElm).html('欢迎您，<span class="black" id="p5w_username">'+decodeURIComponent(e.user.username)+'</span> | <a href="'+e.config.link.logout+'">退出</a> | <a href="'+e.config.link.userhome+'" target="_blank">用户管理中心</a>'),e.distroy()},this.customLoginCallBack=function(t){t.status==0?(e.defaultLoginSuccessCallBack(t),e.callBack()):e.defaultLoginErrorCallBack(t.status)},this.logout=function(){var t=e.createFrame(e.loginFrameName),n=e.createForm(e.loginFormId);n.method="post",n.action=e.config.link.logout,n.target=e.loginFrameName;try{n.submit()}catch(r){t&&t.parentNode.removeChild(t)}n.parentNode.removeChild(n)},this.defaultLogoutCallBack=function(){$(e.loginElm).html('<a href="'+e.config.link.login+'" onclick="passport.draw.init(\'login\');return false;" class="blue_head">登录</a> | <a href="'+e.config.link.reg+'" target="_blank" class="blue_head">注册</a>'),e.distroy()},this.customLogoutCallBack=function(){e.distroy(),window.location.reload()},this.distroy=function(){var t=e.$(e.loginFrameName);t&&t.parentNode.removeChild(t)},this.notice=function(t,n){n||(n="normal");var r;n=="loading"?r='<div class="loading_tips"><img src="'+e.config.link.userhome+'images/loading.gif"><span>'+t+"</span></div>":r=t,typeof e.tipsDiv!="undefined"?typeof e.tipsDiv[0]!="undefined"?n=="normal"?($(e.tipsDiv).html(r).addClass("info_tips"),setTimeout(function(){$(e.tipsDiv).removeClass("info_tips",1500)},500)):$(e.tipsDiv).html(r):alert(t):alert(t)}}String.prototype.trim=function(){return this.replace(/(^[\s\t\xa0\u3000]+)|([\u3000\xa0\s\t]+$)/g,"")},String.prototype.byteLength=function(){return this.replace(/[^\u0000-\u007f]/g,"aa").length},$.fn.Placeholder=function(){function r(){t.html(e.val()?"&nbsp;":t.attr("default_txt")).css({color:e.val()?"":"#ccc"})}function i(e,t){e.val()?t.html("&nbsp;"):t.html(t.attr("default_txt"))}var e=$(this),t=e.parent().find("label");if(!t.length)return;var n=e.attr("name")+"_"+(new Date).getTime();return e.attr("id",n),t.attr("for",n),e.bind("keyup",r).bind("keydown",r).bind("input",r).bind("click",r).bind("focus",r).bind("blur",r),i(e,t),setTimeout(function(e,t){return function(){i(e,t)}}(e,t),100),setInterval(function(e,t){return function(){i(e,t)}}(e,t),800),$(this)},passport=new Passport,$(function(){passport.lib.action(),passport.checkLogin()});